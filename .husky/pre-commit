echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ” Running pre-commit checks..."
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

echo "âœ¨ Formatting staged files..."
NODE_OPTIONS="--no-deprecation" pnpm lint-staged > /dev/null 2>&1

if [ $? -ne 0 ]; then
  echo "âŒ Formatting failed"
  exit 1
fi

echo "âœ… Formatting complete"
echo ""

echo "ğŸ”¨ Building project..."
BUILD_OUTPUT=$(NODE_OPTIONS="--no-deprecation" pnpm build:quiet 2>&1)
BUILD_EXIT=$?

if [ $BUILD_EXIT -ne 0 ]; then
  echo "$BUILD_OUTPUT" | \
    grep -v "DEP0180" | \
    grep -v "vite-plugin-astro-expressive-code" | \
    grep -v "The build was canceled" | \
    grep -E "(ERROR|error|Error|âœ˜|Failed|failed|warning.*ts\([0-9]+\))" || echo "$BUILD_OUTPUT"
  echo ""
  echo "âŒ Build failed"
  exit 1
fi

echo "âœ… Build complete"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âœ… All checks passed!"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
